#!/bin/bash
# Pre-commit hook to prevent committing secrets

# Check for .env files
if git diff --cached --name-only | grep -E "\.env$|\.env\."; then
    echo "❌ ERROR: Cannot commit .env files!"
    echo "Please remove .env files from staging area:"
    echo "  git reset HEAD <file>"
    exit 1
fi

# Check for common secret patterns in staged files
STAGED_FILES=$(git diff --cached --name-only)
if [ -n "$STAGED_FILES" ]; then
    for file in $STAGED_FILES; do
        if [ -f "$file" ]; then
            if grep -E "(api[_-]?key|secret[_-]?key|password|token)\s*=\s*['\"][^'\"]{10,}" "$file" 2>/dev/null; then
                echo "⚠️  WARNING: Potential secrets detected in $file!"
                echo "Please review your changes before committing."
                read -p "Continue anyway? (yes/no): " confirm
                if [ "$confirm" != "yes" ]; then
                    exit 1
                fi
            fi
        fi
    done
fi

exit 0
